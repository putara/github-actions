From d5669c28ddbe7eeb451abce772428a3836845ff0 Mon Sep 17 00:00:00 2001
From: putara <38089082+putara@users.noreply.github.com>
Date: Sun, 30 Nov 2025 00:11:46 +1300
Subject: [PATCH] Add button to view quote tweets

PR #1284
---
 src/sass/tweet/_base.scss | 5 +++++
 src/views/tweet.nim       | 7 ++++---
 2 files changed, 9 insertions(+), 3 deletions(-)

diff --git a/src/sass/tweet/_base.scss b/src/sass/tweet/_base.scss
index 7f2d931..8b9c6e5 100644
--- a/src/sass/tweet/_base.scss
+++ b/src/sass/tweet/_base.scss
@@ -205,6 +205,11 @@
 .tweet-stats {
   margin-bottom: -3px;
   -webkit-user-select: none;
+
+  a {
+    pointer-events: all;
+    color: inherit;
+  }
 }
 
 .tweet-stat {
diff --git a/src/views/tweet.nim b/src/views/tweet.nim
index 58d03a9..f328a41 100644
--- a/src/views/tweet.nim
+++ b/src/views/tweet.nim
@@ -1,5 +1,5 @@
 # SPDX-License-Identifier: AGPL-3.0-only
-import strutils, sequtils, strformat, options, algorithm
+import strutils, sequtils, strformat, options, algorithm, uri
 import karax/[karaxdsl, vdom, vstyles]
 from jester import Request
 
@@ -179,10 +179,11 @@ func formatStat(stat: int): string =
   if stat > 0: insertSep($stat, ',')
   else: ""
 
-proc renderStats(stats: TweetStats): VNode =
+proc renderStats(tweet_id: int64; stats: TweetStats): VNode =
   buildHtml(tdiv(class="tweet-stats")):
     span(class="tweet-stat"): icon "comment", formatStat(stats.replies)
     span(class="tweet-stat"): icon "retweet", formatStat(stats.retweets)
+    a(class="tweet-stat", href=("/search?q=" & encodeUrl(&"-from:quotedreplies url:{tweet_id}") & "&e-nativeretweets=on")): icon "quote"
     span(class="tweet-stat"): icon "heart", formatStat(stats.likes)
     span(class="tweet-stat"): icon "views", formatStat(stats.views)
 
@@ -339,7 +340,7 @@ proc renderTweet*(tweet: Tweet; prefs: Prefs; path: string; class=""; index=0;
         renderMediaTags(tweet.mediaTags)
 
       if not prefs.hideTweetStats:
-        renderStats(tweet.stats)
+        renderStats(tweet.id, tweet.stats)
 
       if showThread:
         a(class="show-thread", href=("/i/status/" & $tweet.threadId)):
-- 
2.51.0

