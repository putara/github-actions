From 9f33d4e8de26854158444e2a4ae4f52bd6ac4a9b Mon Sep 17 00:00:00 2001
From: putara <38089082+putara@users.noreply.github.com>
Date: Tue, 9 Sep 2025 22:12:11 +1200
Subject: [PATCH] HACK: Stop using the companion's latest_version endpoint

---
 src/invidious/routes/video_playback.cr    | 5 -----
 src/invidious/views/components/player.ecr | 4 ----
 2 files changed, 9 deletions(-)

diff --git a/src/invidious/routes/video_playback.cr b/src/invidious/routes/video_playback.cr
index 083087a9..068a7bf6 100644
--- a/src/invidious/routes/video_playback.cr
+++ b/src/invidious/routes/video_playback.cr
@@ -257,11 +257,6 @@ module Invidious::Routes::VideoPlayback
   # YouTube /videoplayback links expire after 6 hours,
   # so we have a mechanism here to redirect to the latest version
   def self.latest_version(env)
-    if CONFIG.invidious_companion.present?
-      invidious_companion = CONFIG.invidious_companion.sample
-      return env.redirect "#{invidious_companion.public_url}/latest_version?#{env.params.query}"
-    end
-
     id = env.params.query["id"]?
     itag = env.params.query["itag"]?.try &.to_i?
 
diff --git a/src/invidious/views/components/player.ecr b/src/invidious/views/components/player.ecr
index 85fa4373..e954b43f 100644
--- a/src/invidious/views/components/player.ecr
+++ b/src/invidious/views/components/player.ecr
@@ -22,8 +22,6 @@
                audio_streams.each_with_index do |fmt, i|
                 src_url  = "/latest_version?id=#{video.id}&itag=#{fmt["itag"]}"
                 src_url += "&local=true" if params.local
-                src_url = invidious_companion.public_url.to_s + src_url + 
-                            "&check=#{invidious_companion_encrypt(video.id)}" if (invidious_companion)
 
                 bitrate = fmt["bitrate"]
                 mimetype = HTML.escape(fmt["mimeType"].as_s)
@@ -50,8 +48,6 @@
             fmt_stream.each_with_index do |fmt, i|
                 src_url  = "/latest_version?id=#{video.id}&itag=#{fmt["itag"]}"
                 src_url += "&local=true" if params.local
-                src_url = invidious_companion.public_url.to_s + src_url +
-                            "&check=#{invidious_companion_encrypt(video.id)}" if (invidious_companion)
 
                 quality = fmt["quality"]
                 mimetype = HTML.escape(fmt["mimeType"].as_s)
-- 
2.51.0

